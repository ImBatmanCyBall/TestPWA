<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>PAWTestTemplate</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico" />
    <link rel="stylesheet" href="TemplateData/style.css" />
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="stylesheet" type="text/css" href="TemplateData/pwa.css">
    <!-- Ionicons -->
   <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  </head>
  <body class="dark" onload = "checkdevice()">
     <!-- Install instructions for Android -->
 <div id="menu-install-pwa-android" class="menupwa menu-box-bottom menu-box-detached rounded-l" data-menu-height="320"
 data-menu-effect="menu-parallax" style="display: block;">
 <div class=" boxed-text-l mt-4">
  <h3 class="pad1 h5">Add to Home Screen</h3>
       <img class="mt-1 mb-3 br-10" src="TemplateData/icons/unity-logo-dark.png" alt="img" width="80">
     <div class="center">
         <p class="m-1 mt-2 text">
           Install this PWA on Home Screen!
         </p>
     </div>
     <h3 class="mt-2 btn-pwa pwa-install">Install</h3>
     <a href="#"
         class="close close-android pwa-dismiss text-deco close-menu color-black font-800 opacity-80 text-center text-uppercase">
         <ion-icon name="close-outline"></ion-icon></a>
 </div>
</div>
<!-- End Android -->
  <!-- Install instructions for iOS -->
<div id="menu-install-pwa-ios" class="menupwa menu-box-bottom menu-box-detached rounded-l" data-menu-height="220"
data-menu-effect="menu-parallax">
<div class=" boxed-text-l mt-4">
<h3 class="pad1 h5">Add to Home Screen</h3>
<img class="mt-1 mb-3 br-10" src="TemplateData/icons/unity-logo-dark.png" alt="img" width="100">
<div class="center mb-3">
    <p class="m-1 mt-2 text-b"> 
        Install this <b>PWA</b> on your homescreen. Tap<ion-icon class="share-icon" name="share-outline"></ion-icon>
        and Add to Home Screen.
    </p>
</div>
<a href="#"
    class="closeios pwa-dismiss text-deco close-menu color-black font-800  text-center text-uppercase">
    Close</a>
</div>
</div>
<!-- End instructions for iOS -->
 <!-- Install instructions for firefox-Android -->
 <div id="menu-install-pwa-android-firefox" class="menupwa menu-box-bottom menu-box-detached rounded-l" data-menu-height="220"
 data-menu-effect="menu-parallax">
 <div class=" boxed-text-l mt-4">
 <h3 class="pad1 h5">Add to Home Screen</h3>
 <img class="mt-1 mb-3 br-10" src="TemplateData/icons/unity-logo-dark.png" alt="img" width="100">
 <div class="center mb-3">
     <p class="m-1 mt-2 text-b"> 
         Please open the browser menu and choose <b>Install</b> in the options.
     </p>
 </div>
 <a href="#"
     class="closeios pwa-dismiss text-deco close-menu color-black font-800  text-center text-uppercase">
     Close</a>
 </div>
 </div>
 <!-- End instructions for firefox-Android -->
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
    </div>
    <div id="loading-cover" style="display: none">
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty" style="display: none">
          <div id="unity-progress-bar-full"></div>
        </div>
        <div class="spinner"></div>
      </div>
    </div>
    <div id="unity-fullscreen-button" style="display: none"></div>
    <script>
            const hideFullScreenButton = "";
            const buildUrl = "Build";
            const loaderUrl = buildUrl + "/BuildTest.loader.js";
            const config = {
              dataUrl: buildUrl + "/BuildTest.data",
              frameworkUrl: buildUrl + "/BuildTest.framework.js",
              codeUrl: buildUrl + "/BuildTest.wasm",
              streamingAssetsUrl: "StreamingAssets",
              companyName: "Xex",
              productName: "PAWTestTemplate",
              productVersion: "1.0",
            };

            const container = document.querySelector("#unity-container");
            const canvas = document.querySelector("#unity-canvas");
            const loadingCover = document.querySelector("#loading-cover");
            const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
            const progressBarFull = document.querySelector("#unity-progress-bar-full");
            const fullscreenButton = document.querySelector("#unity-fullscreen-button");
            const spinner = document.querySelector('.spinner');

            const canFullscreen = (function() {
              for (const key of [
                  'exitFullscreen',
                  'webkitExitFullscreen',
                  'webkitCancelFullScreen',
                  'mozCancelFullScreen',
                  'msExitFullscreen',
                ]) {
                if (key in document) {
                  return true;
                }
              }
              return false;
            }());

            if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
              container.className = "unity-mobile";
              config.devicePixelRatio = 1;
            }
            loadingCover.style.display = "";
            var script = document.createElement("script");
            script.src = loaderUrl;
            function script1(){
            // script.onload = () => {
              import('./lib/thirdweb-unity-bridge.js').then(module => {
                createUnityInstance(canvas, config, (progress) => {
                  spinner.style.display = "none";
                  progressBarEmpty.style.display = "";
                  progressBarFull.style.width = `${100 * progress}%`;
                }).then((unityInstance) => {
                  loadingCover.style.display = "none";
                  if (canFullscreen) {
                    if (!hideFullScreenButton) {
                      fullscreenButton.style.display = "";
                    }
                    fullscreenButton.onclick = () => {
                      unityInstance.SetFullscreen(1);
                    };
                  }
                }).catch((message) => {
                  alert(message);
                });
              });
            };
            document.body.appendChild(script);
            if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
  // true for mobile device
  console.log("mobile device");
}else{
  // false for not mobile device
  var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        import('./lib/thirdweb-unity-bridge.js').then(module => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
          loadingCover.style.display = "none";
        }).catch((message) => {
          alert(message);
        });
      });
       }
      // };
      document.body.appendChild(script);
}

    </script>
 <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('ServiceWorker.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script>



$(document).ready(function(){      
  'use strict'	
  var pwaCookie = false; // if set to false, the PWA prompt will appear even if the user selects "maybe later"
  var pwaNoCache = false; // always keep the cache clear to serve the freshest possible content
  
  
  //Creating Cookie System for PWA Hide
  function createCookie(e, t, n) {if (n) {var o = new Date;o.setTime(o.getTime() + 48 * n * 60 * 60 * 1e3);var r = "; expires=" + o.toGMTString()} else var r = "";document.cookie = e + "=" + t + r + "; path=/"}
  function readCookie(e) {for (var t = e + "=", n = document.cookie.split(";"), o = 0; o < n.length; o++) {for (var r = n[o];" " == r.charAt(0);) r = r.substring(1, r.length);if (0 == r.indexOf(t)) return r.substring(t.length, r.length)}return null}
  function eraseCookie(e) {createCookie(e, "", -1)}
  
  //Enabling dismiss button
  setTimeout(function(){
      $('.pwa-dismiss').on('click',function(){
          console.log('User Closed Add to Home / PWA Prompt')
      script1();
          createCookie('pwa_rejected_install', true, 1);
          $('body').find('#menu-install-pwa-android, #menu-install-pwa-ios,#menu-install-pwa-android-firefox,#menu-install-pwa-ios-firefox, .menu-hider').removeClass('menu-active'); 
         
        });
  },1500);
          
  //Detecting Mobile Operating Systems
  var isMobile = {
      chrome: function() {return navigator.userAgent.match(/Chrome/i);},
      Android: function() {return navigator.userAgent.match(/Android/i);},
      iOS: function() {return navigator.userAgent.match(/iPhone|iPad|iPod/i);},
      iOSsafari: function() {return navigator.userAgent.match(/Safari/i) && isMobile.iOS();},
      any: function() {return (isMobile.Android() || isMobile.iOS() || isMobile.Windows());},
      firefox:function  () { return navigator.userAgent.toLowerCase().match(/mozilla/i);},
      firefoxAndroid: function() {return (isMobile.Android() && isMobile.firefox() && !isMobile.chrome());},
  };
  var isInWebAppiOS = (window.navigator.standalone == true);
  var isInWebAppChrome = (window.matchMedia('(display-mode: fullscreen)').matches);   

  if (isMobile.Android()) {
      console.log('Android Detected');
      function showInstallPromotion(){
          if(!$('body').hasClass('is-installed')){
              if($('#menu-install-pwa-android, .add-to-home').length){
                  console.log('Triggering PWA Menu for Android');
                  if (!readCookie('pwa_rejected_install')) {
                      setTimeout(function(){
                        $('#menu-install-pwa-android-firefox, .menu-hider').removeClass('menu-active');
                          $('.add-to-home').addClass('add-to-home-visible add-to-home-android');
                          $('#menu-install-pwa-android, .menu-hider').addClass('menu-active')
                      },500);
                  }
              } else {
                  console.log('The div #menu-install-pwa-android was not found. Please add this div to show the install window')
              }
          }
      }
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          showInstallPromotion();
      });
      $('.pwa-install').on('click',function(e){
          $('body').addClass('is-installed');
        deferredPrompt.prompt();
        deferredPrompt.userChoice
          .then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              script1();
              //console.log('User accepted the A2HS prompt');
            } else {
              //console.log('User dismissed the A2HS prompt');
            }
            deferredPrompt = null;
          });
      });
      window.addEventListener('appinstalled', (evt) => {
          $('#menu-install-pwa-android,#menu-install-pwa-android-firefox .menu-hider').removeClass('menu-active')
          script1();
        });
  }
    if (isMobile.firefoxAndroid()) {
      if(!isInWebAppChrome){
          console.log('Detected');
          if($('#menu-install-pwa-android-firefox, .add-to-home').length){
              if (!readCookie('pwa_rejected_install')) {
                  console.log('Triggering PWA / Add to Home Screen Menu for iOS');
                  setTimeout(function(){
                      $('.add-to-home').addClass('add-to-home-visible add-to-home-ios');
                      $('#menu-install-pwa-android-firefox, .menu-hider').addClass('menu-active');
                      // if(checkdevice()){
                      //   $('#menu-install-pwa-android-firefox, .menu-hider').removeClass('menu-active');
                      // }
                  },500);
              };
          } else {
              console.log('The div #menu-install-pwa-ios was not found. Please add this div to show the install window')
          }
      }
  } 
  

  if (isMobile.iOSsafari()) {
      if(!isInWebAppiOS){
          console.log('iOS Detected');
          if($('#menu-install-pwa-ios, .add-to-home').length){
              if (!readCookie('pwa_rejected_install')) {
                  console.log('Triggering PWA / Add to Home Screen Menu for iOS');
                  setTimeout(function(){
                      $('.add-to-home').addClass('add-to-home-visible add-to-home-ios');
                      $('#menu-install-pwa-ios, .menu-hider').addClass('menu-active');
                  },500);
              };
          } else {
              console.log('The div #menu-install-pwa-ios was not found. Please add this div to show the install window')
          }
      }
  } 

  if(pwaCookie == false){
      eraseCookie('pwa_rejected_install');
  }
  

  if(pwaNoCache == true){
      caches.delete('workbox-runtime').then(function() { 
      });
      localStorage.clear();
      sessionStorage.clear()
      caches.keys().then(cacheNames => {
        cacheNames.forEach(cacheName => {
          caches.delete(cacheName);
        });
      });
  }
});
function checkdevice(){
var isInWebAppiOS = (window.navigator.standalone == true);
    var isInWebAppChrome = (window.matchMedia('(display-mode: fullscreen)').matches);
    if(isInWebAppiOS){
      script1();
      console.log("true");
    }
    if(isInWebAppChrome){
    script1();
  }
}
</script>
</body>
</html>
